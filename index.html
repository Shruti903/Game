<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Tic-Tac-Toe ‚ö°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Orbitron', monospace;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            color: white;
            text-align: center;
            max-width: 600px;
            width: 90%;
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shine 3s infinite;
            pointer-events: none;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        h1 {
            font-size: 2.5em;
            font-weight: 900;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease infinite;
            margin-bottom: 20px;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .setup-screen {
            animation: fadeIn 0.8s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .game-mode-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .mode-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .mode-card:hover {
            transform: translateY(-5px);
            border-color: #4ecdc4;
            box-shadow: 0 10px 30px rgba(78, 205, 196, 0.3);
        }

        .mode-card.selected {
            border-color: #ff6b6b;
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2), rgba(255, 107, 107, 0.1));
            transform: scale(1.05);
        }

        .difficulty-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .difficulty-btn {
            padding: 12px 24px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: transparent;
            color: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
        }

        .difficulty-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .difficulty-btn.selected {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-color: transparent;
        }

        .player-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .input-group {
            position: relative;
        }

        input {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            color: white;
            font-family: 'Orbitron', monospace;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        input:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.3);
        }

        input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .start-btn {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            color: white;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
        }

        .start-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .start-btn:hover::before {
            left: 100%;
        }

        .game-screen {
            display: none;
            animation: slideIn 0.8s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .player-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .player-info.active {
            border-color: #4ecdc4;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.3);
            background: rgba(78, 205, 196, 0.1);
        }

        .score-board {
            display: flex;
            gap: 15px;
            font-weight: 700;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-width: 350px;
            margin: 20px auto;
            perspective: 1000px;
        }

        .cell {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .cell:hover:not(.taken) {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px) rotateX(10deg);
            border-color: #4ecdc4;
            box-shadow: 0 10px 30px rgba(78, 205, 196, 0.3);
        }

        .cell.taken {
            cursor: not-allowed;
        }

        .cell.winning {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            animation: winPulse 1s ease infinite;
        }

        @keyframes winPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .cell::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3), transparent);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }

        .cell:hover::before {
            width: 100%;
            height: 100%;
        }

        .mark {
            animation: markAppear 0.5s ease;
            filter: drop-shadow(0 0 10px currentColor);
        }

        @keyframes markAppear {
            0% { transform: scale(0) rotate(180deg); opacity: 0; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 12px 24px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 15px;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .control-btn:hover {
            transform: translateY(-3px);
            border-color: #4ecdc4;
            box-shadow: 0 5px 20px rgba(78, 205, 196, 0.3);
        }

        .control-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .message {
            margin-top: 20px;
            font-size: 1.3em;
            font-weight: 700;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .message.win {
            color: #4ecdc4;
            animation: celebration 2s ease infinite;
        }

        .message.draw {
            color: #ffd93d;
        }

        @keyframes celebration {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); text-shadow: 0 0 20px #4ecdc4; }
        }

        .fireworks {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: firework 1s ease-out forwards;
        }

        @keyframes firework {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(20);
                opacity: 0;
            }
        }

        .stats {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .ai-thinking {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 15px;
            margin: 10px 0;
            animation: pulse 1.5s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .theme-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .theme-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-btn:hover {
            transform: scale(1.2);
            border-color: white;
        }

        .theme-1 { background: linear-gradient(135deg, #667eea, #764ba2); }
        .theme-2 { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .theme-3 { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .theme-4 { background: linear-gradient(135deg, #43e97b, #38f9d7); }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .game-info {
                flex-direction: column;
                text-align: center;
            }
            
            .player-inputs {
                grid-template-columns: 1fr;
            }
            
            .cell {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <div class="theme-selector">
        <div class="theme-btn theme-1" onclick="changeTheme(1)"></div>
        <div class="theme-btn theme-2" onclick="changeTheme(2)"></div>
        <div class="theme-btn theme-3" onclick="changeTheme(3)"></div>
        <div class="theme-btn theme-4" onclick="changeTheme(4)"></div>
    </div>

    <div class="container">
        <h1>‚ö° Advanced Tic-Tac-Toe ‚ö°</h1>
        
        <div class="setup-screen" id="setupScreen">
            <h2>üéÆ Choose Game Mode</h2>
            <div class="game-mode-selector">
                <div class="mode-card" onclick="selectMode('pvp')">
                    <h3>üë• Player vs Player</h3>
                    <p>Classic multiplayer experience</p>
                </div>
                <div class="mode-card" onclick="selectMode('ai')">
                    <h3>ü§ñ Player vs AI</h3>
                    <p>Challenge the computer</p>
                </div>
            </div>

            <div id="difficultySection" style="display: none;">
                <h3>‚öôÔ∏è AI Difficulty</h3>
                <div class="difficulty-selector">
                    <button class="difficulty-btn" onclick="selectDifficulty('easy')">üòä Easy</button>
                    <button class="difficulty-btn" onclick="selectDifficulty('medium')">üòê Medium</button>
                    <button class="difficulty-btn" onclick="selectDifficulty('hard')">üò§ Hard</button>
                    <button class="difficulty-btn" onclick="selectDifficulty('impossible')">üíÄ Impossible</button>
                </div>
            </div>

            <div class="player-inputs">
                <div class="input-group">
                    <input type="text" id="player1" placeholder="Player 1 Name ‚ùå">
                </div>
                <div class="input-group">
                    <input type="text" id="player2" placeholder="Player 2 Name ‚≠ï">
                </div>
            </div>

            <button class="start-btn" onclick="startGame()">üöÄ Start Game</button>
        </div>

        <div class="game-screen" id="gameScreen">
            <div class="game-info">
                <div class="player-info" id="player1Info">
                    <div id="player1Name">Player 1</div>
                    <div>‚ùå</div>
                </div>
                <div class="score-board">
                    <div>üèÜ <span id="player1Score">0</span></div>
                    <div>ü§ù <span id="drawScore">0</span></div>
                    <div>üèÜ <span id="player2Score">0</span></div>
                </div>
                <div class="player-info" id="player2Info">
                    <div id="player2Name">Player 2</div>
                    <div>‚≠ï</div>
                </div>
            </div>

            <div id="aiThinking" class="ai-thinking" style="display: none;">
                ü§ñ AI is thinking...
            </div>

            <div class="board" id="board"></div>

            <div class="controls">
                <button class="control-btn" id="undoBtn" onclick="undoMove()">‚Ü∂ Undo</button>
                <button class="control-btn" onclick="resetRound()">üîÑ New Round</button>
                <button class="control-btn" onclick="resetGame()">üè† Main Menu</button>
                <button class="control-btn" id="hintBtn" onclick="getHint()">üí° Hint</button>
            </div>

            <div class="message" id="gameMessage"></div>

            <div class="stats">
                <div class="stat-card">
                    <div>üéØ Moves</div>
                    <div id="moveCount">0</div>
                </div>
                <div class="stat-card">
                    <div>‚è±Ô∏è Time</div>
                    <div id="gameTime">00:00</div>
                </div>
                <div class="stat-card">
                    <div>üéÆ Round</div>
                    <div id="roundCount">1</div>
                </div>
            </div>
        </div>
    </div>

    <div class="fireworks" id="fireworks"></div>

    <script>
        let gameState = {
            board: Array(9).fill(null),
            currentPlayer: "‚ùå",
            gameMode: null,
            difficulty: 'medium',
            player1Name: "Player 1",
            player2Name: "Player 2",
            gameOver: false,
            moveStack: [],
            scores: { player1: 0, player2: 0, draws: 0 },
            startTime: null,
            moveCount: 0,
            roundCount: 1
        };

        const boardElement = document.getElementById("board");
        const messageElement = document.getElementById("gameMessage");
        const themes = [
            "linear-gradient(135deg, #667eea 0%, #764ba2 100%)",
            "linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",
            "linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",
            "linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"
        ];

        function changeTheme(themeIndex) {
            document.body.style.background = themes[themeIndex - 1];
        }

        function selectMode(mode) {
            gameState.gameMode = mode;
            document.querySelectorAll('.mode-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.mode-card').classList.add('selected');
            
            if (mode === 'ai') {
                document.getElementById('difficultySection').style.display = 'block';
                document.getElementById('player2').placeholder = "AI Name ü§ñ";
                document.getElementById('player2').value = "AI Bot";
            } else {
                document.getElementById('difficultySection').style.display = 'none';
                document.getElementById('player2').placeholder = "Player 2 Name ‚≠ï";
                document.getElementById('player2').value = "";
            }
        }

        function selectDifficulty(difficulty) {
            gameState.difficulty = difficulty;
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
        }

        function startGame() {
            if (!gameState.gameMode) {
                alert('Please select a game mode!');
                return;
            }

            gameState.player1Name = document.getElementById('player1').value || "Player 1";
            gameState.player2Name = document.getElementById('player2').value || (gameState.gameMode === 'ai' ? "AI Bot" : "Player 2");
            
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            
            document.getElementById('player1Name').textContent = gameState.player1Name;
            document.getElementById('player2Name').textContent = gameState.player2Name;
            
            resetRound();
            startTimer();
        }

        function createBoard() {
            boardElement.innerHTML = "";
            gameState.board.forEach((cell, index) => {
                let cellElement = document.createElement("div");
                cellElement.classList.add("cell");
                if (cell) {
                    cellElement.innerHTML = `<span class="mark">${cell}</span>`;
                    cellElement.classList.add("taken");
                }
                cellElement.onclick = () => makeMove(index);
                boardElement.appendChild(cellElement);
            });
        }

        function makeMove(index) {
            if (gameState.board[index] || gameState.gameOver) return;

            gameState.board[index] = gameState.currentPlayer;
            gameState.moveStack.push({ index, player: gameState.currentPlayer });
            gameState.moveCount++;
            
            createBoard();
            updateStats();
            
            let winner = checkWinner();
            if (winner) {
                handleGameEnd(winner);
                return;
            }

            gameState.currentPlayer = gameState.currentPlayer === "‚ùå" ? "‚≠ï" : "‚ùå";
            updatePlayerIndicator();

            if (gameState.gameMode === 'ai' && gameState.currentPlayer === "‚≠ï" && !gameState.gameOver) {
                setTimeout(makeAIMove, 1000);
            }
        }

        function makeAIMove() {
            document.getElementById('aiThinking').style.display = 'block';
            
            setTimeout(() => {
                let move = getAIMove();
                if (move !== -1) {
                    makeMove(move);
                }
                document.getElementById('aiThinking').style.display = 'none';
            }, Math.random() * 1000 + 500);
        }

        function getAIMove() {
            let availableMoves = gameState.board.map((cell, index) => cell === null ? index : null).filter(val => val !== null);
            
            if (availableMoves.length === 0) return -1;

            switch (gameState.difficulty) {
                case 'easy':
                    return availableMoves[Math.floor(Math.random() * availableMoves.length)];
                
                case 'medium':
                    return Math.random() < 0.7 ? getBestMove() : availableMoves[Math.floor(Math.random() * availableMoves.length)];
                
                case 'hard':
                    return Math.random() < 0.9 ? getBestMove() : availableMoves[Math.floor(Math.random() * availableMoves.length)];
                
                case 'impossible':
                    return getBestMove();
                
                default:
                    return getBestMove();
            }
        }

        function getBestMove() {
            // Check for winning move
            for (let i = 0; i < 9; i++) {
                if (gameState.board[i] === null) {
                    gameState.board[i] = "‚≠ï";
                    if (checkWinner() === "‚≠ï") {
                        gameState.board[i] = null;
                        return i;
                    }
                    gameState.board[i] = null;
                }
            }

            // Block player's winning move
            for (let i = 0; i < 9; i++) {
                if (gameState.board[i] === null) {
                    gameState.board[i] = "‚ùå";
                    if (checkWinner() === "‚ùå") {
                        gameState.board[i] = null;
                        return i;
                    }
                    gameState.board[i] = null;
                }
            }

            // Take center if available
            if (gameState.board[4] === null) return 4;

            // Take corners
            const corners = [0, 2, 6, 8];
            const availableCorners = corners.filter(i => gameState.board[i] === null);
            if (availableCorners.length > 0) {
                return availableCorners[Math.floor(Math.random() * availableCorners.length)];
            }

            // Take any available edge
            const edges = [1, 3, 5, 7];
            const availableEdges = edges.filter(i => gameState.board[i] === null);
            if (availableEdges.length > 0) {
                return availableEdges[Math.floor(Math.random() * availableEdges.length)];
            }

            return -1;
        }

        function checkWinner() {
            const winPatterns = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8],
                [0, 3, 6], [1, 4, 7], [2, 5, 8],
                [0, 4, 8], [2, 4, 6]
            ];

            for (let pattern of winPatterns) {
                let [a, b, c] = pattern;
                if (gameState.board[a] && gameState.board[a] === gameState.board[b] && gameState.board[a] === gameState.board[c]) {
                    highlightWinningCells(pattern);
                    return gameState.board[a];
                }
            }

            if (!gameState.board.includes(null)) {
                return "draw";
            }

            return null;
        }

        function highlightWinningCells(pattern) {
            const cells = document.querySelectorAll('.cell');
            pattern.forEach(index => {
                cells[index].classList.add('winning');
            });
        }

        function handleGameEnd(winner) {
            gameState.gameOver = true;
            
            if (winner === "draw") {
                gameState.scores.draws++;
                messageElement.textContent = "ü§ù It's a Draw!";
                messageElement.className = "message draw";
            } else {
                let winnerName = winner === "‚ùå" ? gameState.player1Name : gameState.player2Name;
                if (winner === "‚ùå") {
                    gameState.scores.player1++;
                } else {
                    gameState.scores.player2++;
                }
                messageElement.textContent = `üéâ ${winnerName} Wins!`;
                messageElement.className = "message win";
                createFireworks();
            }
            
            updateScoreboard();
            setTimeout(() => {
                if (confirm('Play another round?')) {
                    gameState.roundCount++;
                    resetRound();
                }
            }, 2000);
        }

        function createFireworks() {
            const fireworksContainer = document.getElementById('fireworks');
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffd93d'];
            
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.style.left = Math.random() * 100 + '%';
                    firework.style.top = Math.random() * 100 + '%';
                    firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    fireworksContainer.appendChild(firework);
                    
                    setTimeout(() => firework.remove(), 1000);
                }, i * 100);
            }
        }

        function undoMove() {
            if (gameState.moveStack.length === 0 || gameState.gameOver) return;

            let lastMove = gameState.moveStack.pop();
            gameState.board[lastMove.index] = null;
            gameState.moveCount--;
            
            // If playing against AI and last move was AI's, undo player's move too
            if (gameState.gameMode === 'ai' && lastMove.player === "‚≠ï" && gameState.moveStack.length > 0) {
                let playerMove = gameState.moveStack.pop();
                gameState.board[playerMove.index] = null;
                gameState.moveCount--;
            }
            
            gameState.currentPlayer = gameState.moveStack.length % 2 === 0 ? "‚ùå" : "‚≠ï";
            createBoard();
            updateStats();
            updatePlayerIndicator();
            messageElement.textContent = "‚Ü∂ Move undone!";
            messageElement.className = "message";
        }

        function getHint() {
            if (gameState.gameOver || gameState.gameMode === 'ai') return;
            
            let bestMove = getBestMove();
            if (bestMove !== -1) {
                const cells = document.querySelectorAll('.cell');
                cells[bestMove].style.background = 'rgba(78, 205, 196, 0.3)';
                cells[bestMove].style.animation = 'pulse 1s ease 3';
                
                setTimeout(() => {
                    cells[bestMove].style.background = '';
                    cells[bestMove].style.animation = '';
                }, 3000);
                
                messageElement.textContent = "üí° Hint: Check the highlighted cell!";
            }
        }

        function updatePlayerIndicator() {
            document.getElementById('player1Info').classList.toggle('active', gameState.currentPlayer === "‚ùå");
            document.getElementById('player2Info').classList.toggle('active', gameState.currentPlayer === "‚≠ï");
            
            if (!gameState.gameOver) {
                let currentName = gameState.currentPlayer === "‚ùå" ? gameState.player1Name : gameState.player2Name;
                messageElement.textContent = `${currentName}'s turn`;
                messageElement.className = "message";
            }
        }

        function updateScoreboard() {
            document.getElementById('player1Score').textContent = gameState.scores.player1;
            document.getElementById('player2Score').textContent = gameState.scores.player2;
            document.getElementById('drawScore').textContent = gameState.scores.draws;
        }

        function updateStats() {
            document.getElementById('moveCount').textContent = gameState.moveCount;
            document.getElementById('roundCount').textContent = gameState.roundCount;
            
            // Update undo button state
            const undoBtn = document.getElementById('undoBtn');
            undoBtn.classList.toggle('disabled', gameState.moveStack.length === 0 || gameState.gameOver);
            
            // Update hint button state
            const hintBtn = document.getElementById('hintBtn');
            hintBtn.classList.toggle('disabled', gameState.gameMode === 'ai' || gameState.gameOver);
        }

        function startTimer() {
            gameState.startTime = Date.now();
            setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            if (!gameState.startTime) return;
            
            const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
            const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
            const seconds = (elapsed % 60).toString().padStart(2, '0');
            document.getElementById('gameTime').textContent = `${minutes}:${seconds}`;
        }

        function resetRound() {
            gameState.board = Array(9).fill(null);
            gameState.gameOver = false;
            gameState.moveStack = [];
            gameState.currentPlayer = "‚ùå";
            gameState.moveCount = 0;
            messageElement.textContent = "";
            messageElement.className = "message";
            
            createBoard();
            updateStats();
            updatePlayerIndicator();
            
            // Clear any winning highlights
            document.querySelectorAll('.cell').forEach(cell => {
                cell.classList.remove('winning');
            });
        }

        function resetGame() {
            gameState = {
                board: Array(9).fill(null),
                currentPlayer: "‚ùå",
                gameMode: null,
                difficulty: 'medium',
                player1Name: "Player 1",
                player2Name: "Player 2",
                gameOver: false,
                moveStack: [],
                scores: { player1: 0, player2: 0, draws: 0 },
                startTime: null,
                moveCount: 0,
                roundCount: 1
            };
            
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('setupScreen').style.display = 'block';
            
            // Reset form
            document.getElementById('player1').value = '';
            document.getElementById('player2').value = '';
            document.querySelectorAll('.mode-card').forEach(card => card.classList.remove('selected'));
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('selected'));
            document.getElementById('difficultySection').style.display = 'none';
        }

        // Enhanced keyboard controls
        document.addEventListener('keydown', (e) => {
            if (document.getElementById('gameScreen').style.display === 'none') return;
            
            // Number keys 1-9 for cell selection
            if (e.key >= '1' && e.key <= '9') {
                const cellIndex = parseInt(e.key) - 1;
                makeMove(cellIndex);
            }
            
            // Additional shortcuts
            switch(e.key.toLowerCase()) {
                case 'u':
                    undoMove();
                    break;
                case 'r':
                    resetRound();
                    break;
                case 'h':
                    getHint();
                    break;
                case 'escape':
                    resetGame();
                    break;
            }
        });

        // Initialize the game
        createBoard();
        updateStats();

        // Add some particle effects for enhanced visual appeal
        function createParticles() {
            const container = document.querySelector('.container');
            
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.style.position = 'absolute';
                    particle.style.width = '4px';
                    particle.style.height = '4px';
                    particle.style.background = '#4ecdc4';
                    particle.style.borderRadius = '50%';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.top = Math.random() * 100 + '%';
                    particle.style.opacity = '0.7';
                    particle.style.animation = 'float 3s ease-in-out infinite';
                    particle.style.pointerEvents = 'none';
                    
                    container.appendChild(particle);
                    
                    setTimeout(() => particle.remove(), 3000);
                }, i * 150);
            }
        }

        // Add floating animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes float {
                0%, 100% { transform: translateY(0px); }
                50% { transform: translateY(-20px); }
            }
        `;
        document.head.appendChild(style);

        // Create particles periodically
        setInterval(createParticles, 5000);
        
        // Add sound effects (using Web Audio API)
        class SoundManager {
            constructor() {
                this.audioContext = null;
                this.initAudio();
            }
            
            initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Web Audio API not supported');
                }
            }
            
            playSound(frequency, duration, type = 'sine') {
                if (!this.audioContext) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
            
            playMoveSound() {
                this.playSound(800, 0.1);
            }
            
            playWinSound() {
                this.playSound(1000, 0.2);
                setTimeout(() => this.playSound(1200, 0.2), 100);
                setTimeout(() => this.playSound(1500, 0.3), 200);
            }
            
            playErrorSound() {
                this.playSound(300, 0.2, 'square');
            }
        }

        const soundManager = new SoundManager();

        // Enhance move function with sound
        const originalMakeMove = makeMove;
        makeMove = function(index) {
            if (gameState.board[index] || gameState.gameOver) {
                soundManager.playErrorSound();
                return;
            }
            
            soundManager.playMoveSound();
            originalMakeMove(index);
        };

        // Enhance game end with sound
        const originalHandleGameEnd = handleGameEnd;
        handleGameEnd = function(winner) {
            if (winner !== "draw") {
                soundManager.playWinSound();
            }
            originalHandleGameEnd(winner);
        };

        // Add touch support for mobile
        let touchStartX, touchStartY;
        
        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });
        
        document.addEventListener('touchend', (e) => {
            if (!touchStartX || !touchStartY) return;
            
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            
            const diffX = touchStartX - touchEndX;
            const diffY = touchStartY - touchEndY;
            
            // Swipe gestures
            if (Math.abs(diffX) > Math.abs(diffY)) {
                if (Math.abs(diffX) > 50) {
                    if (diffX > 0) {
                        // Swipe left - undo
                        undoMove();
                    } else {
                        // Swipe right - hint
                        getHint();
                    }
                }
            } else {
                if (Math.abs(diffY) > 50) {
                    if (diffY > 0) {
                        // Swipe up - new round
                        resetRound();
                    } else {
                        // Swipe down - main menu
                        resetGame();
                    }
                }
            }
            
            touchStartX = null;
            touchStartY = null;
        });

        console.log(`
        üéÆ Advanced Tic-Tac-Toe Controls:
        
        Keyboard Shortcuts:
        ‚Ä¢ Numbers 1-9: Select cell
        ‚Ä¢ U: Undo move
        ‚Ä¢ R: New round
        ‚Ä¢ H: Get hint
        ‚Ä¢ ESC: Main menu
        
        Touch Gestures:
        ‚Ä¢ Swipe Left: Undo
        ‚Ä¢ Swipe Right: Hint
        ‚Ä¢ Swipe Up: New round
        ‚Ä¢ Swipe Down: Main menu
        
        Features:
        ‚Ä¢ 4 AI difficulty levels
        ‚Ä¢ Sound effects
        ‚Ä¢ Particle animations
        ‚Ä¢ Fireworks on win
        ‚Ä¢ Statistics tracking
        ‚Ä¢ Multiple themes
        ‚Ä¢ Responsive design
        `);
    </script>
</body>
</html>